#!/usr/bin/env sh
#
# DESCRIPTION:
#   Execute magic's desktop :)
#
# MAINTAINER: (s)
#   BeyondMagic © 2021-

#-------------------------------------------------------------------------------
# Environment Variables
#-------------------------------------------------------------------------------

export XDG_CONFIG_HOME="$HOME/.config"

export NO_AT_BRIDGE=1 \
       LIMIT_WALLPAPERS=50 \
       TRASH="$HOME/.local/trash" \
       XWALLPAPERS_FOLDER="$HOME/Images/Wallpapers" \
       XWALLPAPER_HISTORY="$HOME/.cache/xwallpapers_history" \
       XNOTIFY_FIFO="$HOME/.cache/xnotify.fifo" \
       NOTMUCH_CONFIG="$HOME/.config/nt/" \
       PASSWORD_STORE_DIR="$HOME/.config/nt" \
       PARU_CONF="$HOME/.config/paru/paru.conf" \
       EDITOR="nvim" "VISUAL=nvim" \
       BROWSER='firefox-developer-edition' \
       CARGO_HOME="${XDG_CONFIG_HOME}/cargo" \
       GNUPGHOME="${XDG_CONFIG_HOME}/gnupg" \
       SCRIPTS_FOLDER="${HOME}/Git/Projects/creamberry" \
       READER='zathura' \
       BARS_TOP_FIFO='/tmp/top.fifo' \
       BARS_BOTTOM_FIFO='/tmp/bottom.fifo' \
       FILE='nnn' \
       SDL_IM_MODULE="fcitx5" \
       EDITOR='nvim' \
       VISUAL='nvim' \
       GTK2_RC_FILES="$HOME/.config/gtk-2.0/gtkrc-2.0" \
       ZDOTDIR="$HOME/.config/zsh" \
       LESSHISTFILE='/dev/null' \
       PATH="$HOME/.config/.cargo/bin:$HOME/Git/Projects/creamberry/path:$HOME/.local/bin:$PATH"

#-------------------------------------------------------------------------------
# Start shit (Important session)
#-------------------------------------------------------------------------------

#   Just get colours
xrdb ~/.config/xorg/XResources

#   Input method
fcitx5 &

#   Start keyboard manager
dwm &

#   Start our audio visualizer.
glava -m bars &

# Pokit agent
polkit-dumb-agent &

# Set last wallpaper with xwallpaper.
xwallpaper --stretch "$(tail -n1 "$XWALLPAPER_HISTORY")" &

# Set random wallpaper for next time this session is loaded
zsh -c '. ~/.config/zsh/aliasesrc; random_wallpaper sddm'

# Update GTK
zsh -c '. ~/.config/zsh/aliasesrc; up_gtk'

# Picom as compositor
picom --experimental-backends --blur-method dual_kawase --blur-strength 11 &

#-------------------------------------------------------------------------------
# Start shit (Not so important session)
#-------------------------------------------------------------------------------

#  Load a new null module to set when recording
pactl load-module module-null-sink sink_name=null

#  Notifications per tag change
xnotify -o 0<>"$XNOTIFY_FIFO" &

#   Start xbindkeys for keybinds
xbindkeys -f "$HOME/.config/xbindkeys/xbindkeysrc" &

#   Start MPD and MPD Scrible to Lastfm and Music
mpd "$HOME/.config/mpd/mpd.conf" &

#   Start unclutter to make mouse disappear after one second
unclutter --timeout 1 &

#   Open new terminal and todoncli7
st -g '110x25+500+57' -t 'things_of_life' -e 'dash' '-c' 'sh ~/Desktop/THINGS_TO_DO' &

#   Notification server
dunst -s -follow keyboard &

#   Set cursor
gsettings set org.gnome.desktop.interface font-name "$(xgetres theme.font-name)"

#   Start SSH-AGENT and dbus
eval $(ssh-agent) &
gpg-agent --daemon &
export $(dbus-launch) &

#   Set keyboard to ABNT2 PT-BR
setxkbmap -model abnt2 -layout br -variant abnt2 &

#   Set mouse order
xmodmap -e 'pointer = 3 2 1'

#   Start Lemonbar (bottom and top bars)
#"$SCRIPTS_FOLDER"/bars/lemonbars &

#   Start modules for lemonbars (bottom and top bars)
#"$SCRIPTS_FOLDER"/bars/modules &

# Eww beauties
eww daemon
eww open top-bar
eww open bot-bar
~/.config/eww/bars/bottom/dwm_tags_daemon.sh   &
~/.config/eww/bars/bottom/dwm_title_daemon.sh  &
~/.config/eww/bars/bottom/dwm_layout_daemon.sh &
~/.config/eww/bars/top/song_daemon.sh          &

#   TEMP - Warn dwm about the bars space.
echo "." | lemonbar

mpdscribble --conf "$HOME/.config/mpdscribble/mpdscribble.conf" &

#------------------------------------------------
# Remove some folders
#----------------------------------------------------

#rm -rf "$HOME/ダウンロード"

#   Sleep after 7 minutes of inactivity
xautolock -time 7 -locker "lock"
